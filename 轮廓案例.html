<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spinner</title>
    <style>
        .spinnerFaceAdd {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .spinnerFaceAdd div {
            position: absolute;
            width: 3px;
            background: #c3c1b4;
            transition: background-color 0.1s ease;
            border-radius: 5px;
        }
        .spinnerFaceAdd video,
        .spinnerFaceAdd canvas{
            border-radius: 50%;
        }

        @keyframes moveDivFaceAdd {
            0%, 100% {
                transform: rotate(var(--rotation)) translate(0, var(--translation));
            }
            50% {
                transform: rotate(var(--rotation)) translate(0, calc(var(--translation) * 1.2));
            }
        }

        .moveFaceAdd {
            animation: moveDivFaceAdd 0.5s ease!important;
        }

        .activeFaceAdd {
            background-color: #89e07c!important; /* 激活时变成绿色 */
        }

    </style>
</head>
<body style="padding: 100px;">

<div class="spinnerFaceAdd" id="spinnerFaceAdd">
    <video id="visio-login-video" style="display: none; z-index: 1;" width="258" height="258"></video>
    <canvas id="visio-login-canvas" style="z-index: 1;" width="258" height="258"></canvas>
</div>

<!-- 4个按钮，分别代表上下左右 -->
<div>
    <button id="up">Up</button>
    <button id="down">Down</button>
    <button id="left">Left</button>
    <button id="right">Right</button>
</div>

<script>
    let divHeight = 0;
    const directions = {};

    function createspinnerFaceAdd(size, densityFactor) {
        const spinnerFaceAdd = document.getElementById('spinnerFaceAdd');
        //spinnerFaceAdd.innerHTML = ''; // 清空之前的div
        const numberOfDivs = Math.ceil(size * densityFactor); // 调整密集度
        const radius = size / 2; // 计算半径

        for (let i = 0; i < numberOfDivs; i++) {
            const div = document.createElement('div');
            const rotationDegree = (360 / numberOfDivs) * i; // 计算每个div的旋转角度
            div.style.height = `${radius / 2 / 2 / 2}px`; // 设置div的高度为半径大小
            divHeight = radius / 2 / 2;
            div.style.transform = `rotate(${rotationDegree}deg) translate(0, ${radius}px)`; // 旋转并移到圆周
            div.style.setProperty('--rotation', `${rotationDegree}deg`);
            div.style.setProperty('--translation', `${radius}px`);
            spinnerFaceAdd.appendChild(div);
        }

        // 每个方向分配 90° 的角度范围，共 4 个方向
        directions.up = getDivsByAngleRange(315, 360, numberOfDivs).concat(getDivsByAngleRange(0, 45, numberOfDivs)); // 上

        directions.right = getDivsByAngleRange(45, 135, numberOfDivs); // 右
        directions.down = getDivsByAngleRange(135, 225, numberOfDivs); // 下
        directions.left = getDivsByAngleRange(225, 315, numberOfDivs); // 左


    }

    function getDivsByAngleRange(startAngle, endAngle, totalDivs) {
        const divs = [];
        for (let i = 0; i < totalDivs; i++) {
            const rotationDegree = (360 / totalDivs) * i;
            if ((startAngle <= endAngle && rotationDegree >= startAngle && rotationDegree < endAngle) ||
                (startAngle > endAngle && (rotationDegree >= startAngle || rotationDegree < endAngle))) {
                divs.push(i);
            }
        }
        return divs;
    }

    // 调用createspinnerFaceAdd函数，生成258px大小的spinnerFaceAdd
    createspinnerFaceAdd(258, 0.3);

    const buttons = {
        up: document.getElementById('up'),
        down: document.getElementById('down'),
        left: document.getElementById('left'),
        right: document.getElementById('right'),
    };

    Object.keys(buttons).forEach(direction => {
        buttons[direction].addEventListener('click', () => {
            const divs = document.querySelectorAll('.spinnerFaceAdd div');
            const activeDivs = directions[direction]; // 获取该方向的div索引

            activeDivs.forEach((index, i) => {
                setTimeout(() => {
                    divs[index].style.height = '0'; // 初始高度为0
                    void divs[index].offsetWidth; // 强制重绘
                    divs[index].classList.add('moveFaceAdd', 'activeFaceAdd');
                    divs[index].style.height = divHeight + 'px'; // 再设置为期望高度
                }, i * 100);
            });

        });
    });
</script>

</body>
</html>
